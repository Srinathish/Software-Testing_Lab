package runner;

import java.io.IOException;
import java.net.URL;
import java.time.Duration;

import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeOptions;
import org.openqa.selenium.remote.RemoteWebDriver;
import org.openqa.selenium.support.events.EventFiringDecorator;
import org.openqa.selenium.support.events.WebDriverListener;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import utils.EventHandler;

public class TestRunner {
	public static WebDriver driver;
	static int PAGE_LOAD_TIME = 20;
	private String search="";
	private String search2="";
	private String search3="";
	@BeforeMethod
	public WebDriver beforeMethod() throws IOException {
		ChromeOptions chromeOptions = new ChromeOptions();
		XSSFWorkbook work=new XSSFWorkbook("testdata/data.xlsx");
		Sheet sheet=work.getSheet("Sheet1");
		Row row=sheet.getRow(0);
		Cell cell=row.getCell(0);
		Cell cell2=row.getCell(1);
		Cell cell3=row.getCell(2);
	     search=cell.getStringCellValue();
	     search2=cell2.getStringCellValue();
	     search3=cell3.getStringCellValue();
		
		driver = new RemoteWebDriver(new URL("http://localhost:4444/"), chromeOptions);
		driver.get("https://www.firstcry.com/");
		driver.manage().window().maximize();
		driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(PAGE_LOAD_TIME));
		WebDriverListener listener = new EventHandler();
		driver = new EventFiringDecorator<>(listener).decorate(driver);
		return driver;

	}
   @Test
   public void testcase1() throws InterruptedException
   {
	driver.findElement(By.xpath("//input[@id='search_box']")).click();
	driver.findElement(By.xpath("//input[@id='search_box']")).sendKeys(search,Keys.ENTER);
	// driver.findElement(By.xpath("//input[@id='search_box']")).click();
	
	WebDriverWait wait = new WebDriverWait(driver,Duration.ofSeconds(15));
	wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//span[text()='Ethnic Wear']"))).click();
	// driver.findElement(By.xpath("(//span[@class='L14_42 txt'])[4]")).click();
	Thread.sleep(10000);
	
}
@Test
public void testcase2()
{
	driver.findElement(By.xpath("//input[@id='search_box']")).click();
	driver.findElement(By.xpath("//input[@id='search_box']")).sendKeys(search2,Keys.ENTER);
	String url=driver.getCurrentUrl();
	Assert.assertTrue(url.contains("kids-toys"));
	
	
}
@Test
public void testcase3() throws InterruptedException {
    driver.findElement(By.xpath("//input[@id='search_box']")).click();
    driver.findElement(By.xpath("//input[@id='search_box']")).sendKeys(search3, Keys.ENTER);

    WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(15));
    WebElement first = wait.until(ExpectedConditions.visibilityOfElementLocated(
        By.xpath("//img[@title='Fab N Funky Balloon Table Holder | Lightweight & Easy-to-Clip Design | Secure Party Decoration Accessory for Tables | 7 Sticks Holder.']")));

    String title1 = first.getAttribute("title");
    System.out.println("First product title: " + title1);

    
    String parentWindow = driver.getWindowHandle();
    first.click();

    for (String handle : driver.getWindowHandles()) {
        if (!handle.equals(parentWindow)) {
            driver.switchTo().window(handle);
            break;
        }
    }

    String text = driver.findElement(By.xpath("//span[@class='J14R_42']")).getText();

    Assert.assertTrue(text.contains("Balloon Table Holder"));

    Thread.sleep(10000);
}

	@AfterMethod
	public void tearDown() {
		if (driver != null) {
			driver.quit();
		}
	}

}
