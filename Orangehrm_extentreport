package runner;

import org.openqa.selenium.remote.RemoteWebDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.apache.poi.ss.usermodel.Row;
import org.apache.poi.ss.usermodel.Cell;
import org.apache.poi.ss.usermodel.Sheet;
import org.apache.poi.xssf.usermodel.XSSFWorkbook;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.support.events.EventFiringDecorator;
import org.openqa.selenium.support.events.WebDriverListener;
import org.testng.annotations.AfterClass;
import org.testng.annotations.AfterMethod;
import org.testng.annotations.BeforeClass;
import org.testng.annotations.BeforeMethod;
import org.testng.annotations.Test;

import com.aventstack.extentreports.ExtentReports;
import com.aventstack.extentreports.ExtentTest;
import com.aventstack.extentreports.Status;
import com.aventstack.extentreports.reporter.ExtentSparkReporter;
import com.aventstack.extentreports.reporter.configuration.Theme;

import utils.EventHandler;
import java.net.URL;
import java.net.MalformedURLException;
import java.time.Duration;

public class TestPage {

    WebDriver driver;
    ExtentReports reports;
    public String validUsername = "";
    public String validPassword = "";
    public String InvalidUsername = "";
    public String InvalidPassword = "";

    @BeforeClass
    public void generatereports()
    {
        reports = new ExtentReports();
        ExtentSparkReporter spark = new ExtentSparkReporter("reports/myReport.html");
        spark.config().setDocumentTitle("OrangeHRM");
        spark.config().setReportName("Testcase Report");
        spark.config().setTheme(Theme.DARK);
        reports.attachReporter(spark);
    }

    @BeforeMethod
    public void setup() throws MalformedURLException {
        try{
            XSSFWorkbook workbook = new XSSFWorkbook("testdata/Data.xlsx");
            Sheet sheet = workbook.getSheet("Sheet1");
            Row row1 = sheet.getRow(1);
            Row row2 = sheet.getRow(2);
            Cell ceil1 = row1.getCell(0);
            Cell ceil2 = row2.getCell(0);

            validUsername = ceil1.getStringCellValue();
            validPassword = ceil2.getStringCellValue();
            
            Cell ceil3 = row1.getCell(1);
            Cell ceil4 = row2.getCell(1);

            InvalidUsername = ceil3.getStringCellValue();
            InvalidPassword = ceil4.getStringCellValue();

            driver = new RemoteWebDriver(new URL("http://localhost:4444"), new ChromeOptions());
            driver.manage().window().maximize();
            driver.get("https://opensource-demo.orangehrmlive.com/");
            driver.manage().timeouts().pageLoadTimeout(Duration.ofSeconds(15));
            driver.manage().timeouts().implicitlyWait(Duration.ofSeconds(15));
            WebDriverListener listener = new EventHandler();
            driver = new EventFiringDecorator<>(listener).decorate(driver);

        }catch(Exception e){
            e.printStackTrace();
        }
    }

   //start your script here
   @Test
    public void testcase1()
    {
        try{
            ExtentTest test = reports.createTest("orangehrm testcase 1");
            WebElement username = driver.findElement(By.xpath("//input[@name = 'username']"));
            username.click();
            username.sendKeys(validUsername);
            test.log(Status.INFO,"This is valid credentials");

            Thread.sleep(2000);

            WebElement password = driver.findElement(By.xpath("//input[@name = 'password']"));
            password.click();
            password.sendKeys(validPassword);

            Thread.sleep(2000);

            WebElement login = driver.findElement(By.xpath("//button[@type = 'submit']"));
            login.click();
            Thread.sleep(2000);
        }catch(Exception e){
            e.printStackTrace();
        }
    } 

    @Test
    public void testcase2()
    {
        try{
            ExtentTest test2 = reports.createTest("orangehrm testcase 2");
            WebElement username = driver.findElement(By.xpath("//input[@name = 'username']"));
            username.click();
            username.sendKeys(InvalidUsername);

            test2.log(Status.FAIL,"uername and password are invalid");
            Thread.sleep(2000);

            WebElement password = driver.findElement(By.xpath("//input[@name = 'password']"));
            password.click();
            password.sendKeys(InvalidPassword);

            Thread.sleep(2000);

            WebElement login = driver.findElement(By.xpath("//button[@type = 'submit']"));
            login.click();
            Thread.sleep(2000);
        }catch(Exception e){
            e.printStackTrace();
        }
    }

    @AfterMethod
    public void teardown()
    {
        //quit your driver
        driver.quit();
        //flush your reports
    }
    @AfterClass
    public void finalReports(){
        reports.flush();
    }
}
